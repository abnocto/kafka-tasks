### Запуск инфраструктуры
```bash
docker compose up -d kafka-0 kafka-1 kafka-2 schema-registry kafka-ui
```

### Создание топика `items` в kafka
```bash
docker exec -it $(docker compose ps -q kafka-0) kafka-topics.sh --bootstrap-server kafka-0:9092 --create --topic items --partitions 3 --replication-factor 2
```

### Запуск приложения в двух экземплярах
```bash
docker compose up -d --scale module-1=2 module-1
```

### Проверка статуса
```bash
docker compose ps
```

### Просмотр логов приложения
```bash
docker compose logs -f module-1
```

### Как работает приложение
* При запуске приложения запускаются три процесса - для продюсера и двух консюмеров.

* Продюсер реализует цикл отправки сообщений в топик items:
    * Случайным образом генерирует сообщение (Item) и сериализует его.
    * Случайным образом выбирает партицию топика.
    * Отправляет сообщение с гарантией доставки (как минимум должно быть записано в лидера).
* Первый консюмер (Single) подписывается на топик items и выполняет цикл чтения сообщений:
    * Считывает сообщение и десериализует его.
    * Обрабатывает его и автоматически коммитит смещение.
* Второй консюмер (Batch) тоже подписывается на топик items и читает сообщения:
    * Но сконфигурирован таким образом, чтобы читать 10 сообщений за один раз.
    * Обрабатывает полученные сообщения в цикле и только после этого сам коммитит смещение.

* Приложение запускается в двух экземплярах. Single и Batch консюмеры принадлежат разным группам консюмеров. Таким образом при запуске в подобной конфигурации будут работать по два процесса консюмеров каждого типа (две группы консюмеров по два консюмера в каждой).
    * Это значит, что две группы консюмеров будут читать сообщения независимо (каждое сообщение будет прочитано каждой группой консюмеров).
    * При этом, так как в каждой группе находится по два консюмера, kafka будет выполнять балансировку сообщений между консюмерами внутри каждой группы, разделяя партиции между консюмерами.
        * Например, Single продюсер первого экземпляра приложения может читать сообщения топика из партиций 0 и 1, а Single продюсер второго экземпляра - из партиции 2.
        * Наоборот, Batch продюсер первого экземпляра может читать сообщения из партиции 0, а второго экземпляра - из партиций 1 и 2.

* В приложении ведется запись логов, с помощью которых можно убедиться в корректности работы приложения. Так же можно контролировать запись сообщений и их разбор продюсерами с помощью Kafka UI.
    * Логируются:
        * Факт отправки сообщения продюсером и подтверждения его доставки
        * Факт получения сообщения (или батча сообщений) консьюмером
        * Ошибки уровня процессов и приложения

### Конфигурация

#### Основная конфигурация (KRaft режим)

| Параметр | Используемое значение | Краткое описание |
|----------|----------------------|------------------|
| KAFKA_ENABLE_KRAFT | yes | Включает режим KRaft (Kafka без Zookeeper) |
| ALLOW_PLAINTEXT_LISTENER | yes | Разрешает незашифрованные подключения |
| KAFKA_CFG_NODE_ID | 0 | Уникальный идентификатор узла в кластере |
| KAFKA_CFG_PROCESS_ROLES | broker,controller | Роли узла: брокер и контроллер |
| KAFKA_CFG_CONTROLLER_LISTENER_NAMES | CONTROLLER | Имя слушателя для контроллера |
| KAFKA_CFG_CONTROLLER_QUORUM_VOTERS | 0@kafka-0:9093 | Список контроллеров кластера |
| KAFKA_KRAFT_CLUSTER_ID | abcdefghijklmnopqrstuv | Уникальный идентификатор кластера |
| KAFKA_CFG_LISTENERS | PLAINTEXT://:9092,CONTROLLER://:9093,EXTERNAL://:9094 | Адреса и порты, на которые принимаются соединения |
| KAFKA_CFG_ADVERTISED_LISTENERS | PLAINTEXT://kafka-0:9092,EXTERNAL://127.0.0.1:9094 | Адреса и порты, "рекламируемые" клиентам |
| KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP | CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT | Протоколы безопасности |

#### Kafka UI конфигурация

| Параметр | Используемое значение | Краткое описание |
|----------|----------------------|------------------|
| KAFKA_CLUSTERS_0_BOOTSTRAP_SERVERS | kafka-0:9092 | Адрес сервера Kafka для подключения |
| KAFKA_CLUSTERS_0_NAME | kafka-cluster | Имя кластера в интерфейсе |

#### Schema Registry конфигурация

| Параметр | Используемое значение | Краткое описание |
|----------|----------------------|------------------|
| SCHEMA_REGISTRY_LISTENERS | http://0.0.0.0:8081 | Адрес и порт для Schema Registry |
| SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS | kafka-0:9092 | Подключение к кластеру Kafka |
