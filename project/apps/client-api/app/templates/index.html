<!DOCTYPE html>
<html>
  <head>
    <title>Client API</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="mt-5 mb-4">Client API</h1>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <textarea class="form-control search" rows="4"></textarea>
          </div>
          <button class="btn btn-primary search-button">Найти</button>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <textarea class="form-control recommend" rows="4"></textarea>
          </div>
          <button class="btn btn-primary recommend-button">Рекомендовать</button>
        </div>
      </div>

      <div class="row mt-5 items-container"></div>
    </div>

    <script>
      const searchTextarea = document.querySelector(".search");

      searchTextarea.value = JSON.stringify(
        {
          user_id: "123",
          search: "умные часы",
        },
        null,
        2
      );

      const searchButton = document.querySelector(".search-button");

      searchButton.addEventListener("click", () =>
        fetchItems("/items/search", searchTextarea.value)
      );

      const recommendTextarea = document.querySelector(".recommend");

      recommendTextarea.value = JSON.stringify(
        {
          user_id: "123",
        },
        null,
        2
      );

      const recommendButton = document.querySelector(".recommend-button");

      recommendButton.addEventListener("click", () =>
        fetchItems("/items/recommend", recommendTextarea.value)
      );

      const itemsContainer = document.querySelector(".items-container");

      async function fetchItems(endpoint, body) {
        itemsContainer.innerHTML = "";

        const response = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body,
        });

        if (!response.ok) {
          return;
        }

        const items = await response.json();

        items.forEach((item) => {
          const itemCard = document.createElement("div");
          itemCard.classList.add("col-md-4", "mb-4");

          itemCard.innerHTML = `
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">${item.name}</h5>
                <p class="card-text">${item.description}</p>
                <p class="card-text"><strong>${item.price.amount} ${item.price.currency}</strong></p>
              </div>
            </div>
          `;

          itemsContainer.appendChild(itemCard);
        });
      }
    </script>
  </body>
</html>